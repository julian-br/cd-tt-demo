---
import AudioPlayer from "./AudioPlayer.astro";

export interface Props {
  title: string;
  folderName: string;
}
const { title, folderName } = Astro.props;

const modules = await import.meta.glob("/src/assets/audio/**/*.wav");

const audioFilesInFolder = [];
for (const path in modules) {
  if (path.includes(`/${folderName}/`)) {
    const module = (await modules[path]()) as { default: string };
    audioFilesInFolder.push({
      webPath: module.default,
      originalPath: path,
    });
  }
}
---

<div class="mb-6 bg-white shadow-sm rounded-lg">
  <h2
    class="mx-2 pt-1 font-bold text-sm text-slate-700 mb-2 border-b border-slate-400 pb-2"
  >
    {title}
  </h2>

  <div class="space-y-1 mb-1">
    {
      audioFilesInFolder.length > 0 ? (
        audioFilesInFolder.map((audioFile, index) => {
          const fileName = audioFile.originalPath.split("/").pop();
          if (!fileName) return;

          const specFileName = fileName.replace(/\.[^/.]+$/, ".png");
          const specImagePath = `/assets/spectrograms/${folderName}/${specFileName}`;
          return (
            <div
              class:list={[
                "bg-white mx-2 border-slate-300",
                index === audioFilesInFolder.length - 1 ? "" : "border-b",
              ]}
            >
              <AudioPlayer src={audioFile.webPath} specPath={specImagePath} />
            </div>
          );
        })
      ) : (
        <p class="text-slate-500">No Audio in '{folderName}' found.</p>
      )
    }
  </div>
</div>
